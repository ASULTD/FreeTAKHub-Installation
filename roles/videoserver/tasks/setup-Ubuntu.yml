---
- name: Get RTSP Simple Server release information using GitHub API
  uri:
    url: "{{ videoserver_url }}"
    return_content: true
  register: videoserver_response

- name: Download and unarchive videoserver
  unarchive:
    src: "{{ videoserver_response.json.assets[1].browser_download_url }}"
    dest: "{{ videoserver_download_location }}"
    remote_src: true

- name: Copy rtsp-simple-server.yml config to /opt
  copy:
    src: "{{ videoserver_download_location }}/rtsp-simple-server.yml"
    dest: "{{ videoserver_config_location }}/rtsp-simple-server.yml"
    remote_src: true

- name: Copy videoserver executable to /usr/local/bin
  copy:
    src: "{{ videoserver_download_location }}/rtsp-simple-server"
    dest: "{{ videoserver_executable_location }}/rtsp-simple-server"
    remote_src: true

- name: Ensure videoserver executable is executable
  file:
    path: "{{ videoserver_executable_location }}/rtsp-simple-server"
    mode: 0755
